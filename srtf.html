<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SRTF</title>
    <link rel="stylesheet" href="styles.css">
</head>

<body>
    <img src="https://i.pinimg.com/736x/71/7e/1e/717e1e8ef23e658ab8964928b84caa3e.jpg" alt="Logo" class="logo">

    <div class="content">
        <h1>SRTF</h1>
        <div class="form-group">
            <label for="numProcessesSrtf">Number of Processes:</label>
            <input type="number" id="numProcessesSrtf" min="1" value="3">
            <button id="generateBtn">Generate Form</button>
        </div>
        <div id="processForm" class="form-group"></div>
        <button id="calculateBtn">Calculate</button>
        <div id="result"></div>
    </div>

    <footer>
        <div>Â© Eclipse.inc</div>
        <div>Nama Pembuat: M.Risqullah</div>
    </footer>

    <script>
        // Fungsi untuk membuat form inputan proses
        function generateForm() {
            const numProcesses = document.getElementById('numProcessesSrtf').value;
            const formContainer = document.getElementById('processForm');
            formContainer.innerHTML = '';
            for (let i = 1; i <= numProcesses; i++) {
                const formDiv = document.createElement('div');
                formDiv.className = 'form-group';
                formDiv.innerHTML = `
                <label>Process ${i}:</label>
                <input type="text" id="processName${i}" placeholder="Process Name">
                <input type="number" id="arrivalTime${i}" placeholder="Arrival Time">
                <input type="number" id="burstTime${i}" placeholder="Burst Time">
            `;
                formContainer.appendChild(formDiv);
            }
        }

        // Fungsi untuk menghitung SRTF
        function calculate() {
            const numProcesses = document.getElementById('numProcessesSrtf').value;
            const processes = [];
            for (let i = 1; i <= numProcesses; i++) {
                processes.push({
                    name: document.getElementById(`processName${i}`).value || `P${i}`,
                    arrivalTime: parseFloat(document.getElementById(`arrivalTime${i}`).value) || 0,
                    burstTime: parseFloat(document.getElementById(`burstTime${i}`).value) || 1,
                    originalBurstTime: parseFloat(document.getElementById(`burstTime${i}`).value) || 1,
                    remainingTime: parseFloat(document.getElementById(`burstTime${i}`).value) || 1,
                    completionTime: null,
                    waitingTime: 0,
                    turnaroundTime: 0
                });
            }
            const result = srtf(processes);
            displayResult(result);
        }

        // Fungsi algoritma SRTF
        function srtf(processes) {
            let currentTime = 0;
            const timeline = [];
            let executingProcess = null;
            let completed = 0;

            while (completed < processes.length) {
                const readyProcesses = processes.filter(p =>
                    p.arrivalTime <= currentTime &&
                    p.completionTime === null &&
                    p.remainingTime > 0
                );

                if (readyProcesses.length === 0) {
                    currentTime++;
                    continue;
                }

                readyProcesses.sort((a, b) =>
                    a.remainingTime - b.remainingTime ||
                    a.priority - b.priority ||
                    a.arrivalTime - b.arrivalTime
                );

                const nextProcess = readyProcesses[0];

                if (executingProcess === null) {
                    executingProcess = nextProcess;
                } else if (executingProcess.remainingTime > nextProcess.remainingTime) {
                    timeline.push({
                        process: executingProcess.name,
                        start: currentTime,
                        end: currentTime + (executingProcess.remainingTime - nextProcess.remainingTime)
                    });

                    const executionTime = executingProcess.remainingTime - nextProcess.remainingTime;
                    executingProcess.remainingTime -= executionTime;
                    currentTime += executionTime;

                    if (executingProcess.remainingTime === 0) {
                        executingProcess.completionTime = currentTime;
                        executingProcess.turnaroundTime = currentTime - executingProcess.arrivalTime;
                        executingProcess.waitingTime = executingProcess.turnaroundTime - executingProcess.burstTime;
                        completed++;
                        executingProcess = nextProcess;
                    }
                } else {
                    executingProcess = nextProcess;
                }

                if (executingProcess.remainingTime > 0) {
                    timeline.push({
                        process: executingProcess.name,
                        start: currentTime,
                        end: currentTime + executingProcess.remainingTime
                    });

                    currentTime += executingProcess.remainingTime;
                    executingProcess.completionTime = currentTime;
                    executingProcess.turnaroundTime = currentTime - executingProcess.arrivalTime;
                    executingProcess.waitingTime = executingProcess.turnaroundTime - executingProcess.burstTime;
                    completed++;
                }
            }

            return {
                processes: processes,
                avgWaitingTime: processes.reduce((sum, p) => sum + p.waitingTime, 0) / processes.length,
                avgTurnaroundTime: processes.reduce((sum, p) => sum + p.turnaroundTime, 0) / processes.length,
                timeline: timeline
            };
        }
        // Fungsi untuk menampilkan hasil
        function displayResult(result) {
            const resultDiv = document.getElementById('result');
            resultDiv.innerHTML = '';

            // Tabel hasil
            const table = document.createElement('table');
            const headers = ['Process', 'Arrival Time', 'Burst Time', 'Completion Time', 'Waiting Time', 'Turnaround Time'];
            const thead = document.createElement('thead');
            const headerRow = document.createElement('tr');
            headers.forEach(header => {
                const th = document.createElement('th');
                th.textContent = header;
                headerRow.appendChild(th);
            });
            thead.appendChild(headerRow);
            table.appendChild(thead);

            const tbody = document.createElement('tbody');
            result.processes.forEach(process => {
                const row = document.createElement('tr');
                row.innerHTML = `
            <td>${process.name}</td>
            <td>${process.arrivalTime}</td>
            <td>${process.burstTime}</td>
            <td>${process.completionTime}</td>
            <td>${process.waitingTime}</td>
            <td>${process.turnaroundTime}</td>
        `;
                tbody.appendChild(row);
            });
            table.appendChild(tbody);
            resultDiv.appendChild(table);

            // Rata-rata
            const avgRow = document.createElement('div');
            avgRow.innerHTML = `
        <p><strong>Average Waiting Time:</strong> ${result.avgWaitingTime.toFixed(2)}</p>
        <p><strong>Average Turnaround Time:</strong> ${result.avgTurnaroundTime.toFixed(2)}</p>
    `;
            resultDiv.appendChild(avgRow);

            // Gantt Chart
            const ganttDiv = document.createElement('div');
            ganttDiv.className = 'gantt-chart';
            ganttDiv.innerHTML = '<h3>Gantt Chart</h3>';

            const ganttTable = document.createElement('table');
            ganttTable.className = 'gantt-table';
            ganttTable.style.width = '100%';

            // Baris proses
            const processRow = document.createElement('tr');
            const timelineRow = document.createElement('tr');

            let currentStart = result.timeline ? result.timeline[0].start : 0;
            let currentProcess = result.timeline ? result.timeline[0].process : result.processes[0].name;
            let processStartTime = currentStart;

            if (result.timeline) {
                result.timeline.forEach((event, index) => {
                    if (index === 0) return;

                    if (event.process !== currentProcess) {
                        // Create cell for previous process
                        const processCell = document.createElement('td');
                        processCell.className = 'gantt-process';
                        processCell.textContent = currentProcess;
                        processCell.style.width = `${(event.start - processStartTime) * 50}px`;
                        processRow.appendChild(processCell);

                        const timelineCell = document.createElement('td');
                        timelineCell.textContent = processStartTime;
                        timelineCell.style.width = `${(event.start - processStartTime) * 50}px`;
                        timelineRow.appendChild(timelineCell);

                        currentProcess = event.process;
                        processStartTime = event.start;
                    }
                });

                // Add the last process
                const lastProcessCell = document.createElement('td');
                lastProcessCell.className = 'gantt-process';
                lastProcessCell.textContent = currentProcess;
                lastProcessCell.style.width = `${(result.timeline[result.timeline.length - 1].end - processStartTime) * 50}px`;
                processRow.appendChild(lastProcessCell);

                const lastTimelineCell = document.createElement('td');
                lastTimelineCell.textContent = processStartTime;
                lastTimelineCell.style.width = `${(result.timeline[result.timeline.length - 1].end - processStartTime) * 50}px`;
                timelineRow.appendChild(lastTimelineCell);

                // Add end time cell
                const endCell = document.createElement('td');
                endCell.textContent = result.timeline[result.timeline.length - 1].end;
                endCell.style.borderLeft = '1px solid #000';
                timelineRow.appendChild(endCell);
            } else {
                let startTime = 0;
                result.processes.forEach(process => {
                    const processCell = document.createElement('td');
                    processCell.className = 'gantt-process';
                    processCell.textContent = process.name;
                    processCell.style.width = `${process.burstTime * 50}px`;
                    processRow.appendChild(processCell);

                    const timelineCell = document.createElement('td');
                    timelineCell.textContent = startTime;
                    timelineCell.style.width = `${process.burstTime * 50}px`;
                    timelineRow.appendChild(timelineCell);
                    startTime += process.burstTime;
                });

                // Add end time cell
                const endCell = document.createElement('td');
                endCell.textContent = startTime;
                endCell.style.borderLeft = '1px solid #000';
                timelineRow.appendChild(endCell);
            }

            ganttTable.appendChild(processRow);
            ganttTable.appendChild(timelineRow);
            ganttDiv.appendChild(ganttTable);
            resultDiv.appendChild(ganttDiv);

            // Cara menghitung rata-rata
            const stepsDiv = document.createElement('div');
            stepsDiv.className = 'calculation-steps';
            stepsDiv.innerHTML = `
        <h3>How to Calculate Averages:</h3>
        <p><strong>Average Waiting Time:</strong></p>
        <p>${result.processes.map(p => p.waitingTime).join(' + ')
                } / ${result.processes.length} = ${result.avgWaitingTime.toFixed(2)}</p>
        <p><strong>Average Turnaround Time:</strong></p>
        <p>${result.processes.map(p => p.turnaroundTime).join(' + ')
                } / ${result.processes.length} = ${result.avgTurnaroundTime.toFixed(2)}</p>
    `;
            resultDiv.appendChild(stepsDiv);
        }

        document.getElementById('generateBtn').addEventListener('click', generateForm);
        document.getElementById('calculateBtn').addEventListener('click', calculate);
    </script>
</body>

</html>